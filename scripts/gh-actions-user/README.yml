# GitHub Actions User Template

This cloudformation template is used to create and maintain the aws user and permissions needed by this repo's github action workflows. This template is only applied manually as a one-time step or as needed for updates.

## Usage Examples:

<details><summary>Create aws user</summary><br/>
 <ul>
  <details><summary>dev</summary><br/>


aws cloudformation create-stack --stack-name dex-shell-gh-actions-user --template-body file://main.yml --parameters ParameterKey=AssetsEcrRepository,ParameterValue=dex-shell ParameterKey=LambdaService,ParameterValue=dex-shell ParameterKey=WebAppBucket,ParameterValue=app  ParameterKey=ExternalId,ParameterValue=dex-shell ParameterKey=ProjectName,ParameterValue=dex-shell  --tags Key=project,Value=dex-shell --region us-east-2 --capabilities CAPABILITY_NAMED_IAM 



  </details>
  <details><summary>stg</summary><br/>


NEED TO UPDATE


  </details>
  <details><summary>prod2</summary><br/>


aws cloudformation create-stack --stack-name dex-shell-gh-actions-user --template-body file://main.yml --parameters ParameterKey=AssetsEcrRepository,ParameterValue=dex-shell ParameterKey=LambdaService,ParameterValue=dex-shell ParameterKey=WebAppBucket,ParameterValue=app  ParameterKey=ExternalId,ParameterValue=dex-shell ParameterKey=ProjectName,ParameterValue=dex-shell  --tags Key=project,Value=dex-shell --region us-east-2 --capabilities CAPABILITY_NAMED_IAM 



  </details>
 </ul>
 </details>

<details><summary>Update aws user</summary><br/>
 <ul>
  <details><summary>dev</summary><br/>

  
aws cloudformation update-stack --stack-name dex-shell-gh-actions-user --template-body file://main.yml --parameters ParameterKey=AssetsEcrRepository,ParameterValue=dex-shell ParameterKey=LambdaService,ParameterValue=dex-shell ParameterKey=WebAppBucket,ParameterValue=app  ParameterKey=ExternalId,ParameterValue=dex-shell ParameterKey=ProjectName,ParameterValue=dex-shell  --tags Key=project,Value=dex-shell --region us-east-2 --capabilities CAPABILITY_NAMED_IAM 



  </details>
  <details><summary>stg</summary><br/>


NEED TO UPDATE

  </details>
  <details><summary>prod2</summary><br/>


aws cloudformation update-stack --stack-name dex-shell-gh-actions-user --template-body file://main.yml --parameters ParameterKey=AssetsEcrRepository,ParameterValue=dex-shell ParameterKey=LambdaService,ParameterValue=dex-shell ParameterKey=WebAppBucket,ParameterValue=app  ParameterKey=ExternalId,ParameterValue=dex-shell ParameterKey=ProjectName,ParameterValue=dex-shell  --tags Key=project,Value=dex-shell --region us-east-2 --capabilities CAPABILITY_NAMED_IAM --profile nonprod



  </details>
 </ul>
 </details>

<details><summary>Delete aws user</summary><br/>
Delete command is same for all environment, as stack-name is same


aws cloudformation delete-stack --stack-name dex-shell-gh-actions-user --region us-east-2


  </details>
 </ul>
 </details>

## </details>

NOTE: This github action user pattern and cloudformation template is based on:

- https://medium.com/cloud-recipes/configuring-github-actions-to-access-aws-efb9fe13d722
- https://github.com/antklim/gh-actions-user
- https://github.com/aws-actions/configure-aws-credentials
